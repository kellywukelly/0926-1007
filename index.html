<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£ â‡„ å†°å³¶ èˆªç­è¡Œç¨‹äº’å‹•ç¸½è¦½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .main-tab-active {
            border-color: #0284c7; /* sky-600 */
            color: #0284c7; /* sky-600 */
            background-color: #f0f9ff; /* sky-50 */
        }
        .main-tab-inactive {
            border-color: transparent;
        }
        .sub-tab-active {
            background-color: #ccfbf1; /* teal-100 */
            color: #0d9488; /* teal-600 */
            border-color: #0d9488; /* teal-600 */
        }
        .sub-tab-inactive {
            background-color: #f1f5f9; /* slate-100 */
            color: #475569; /* slate-600 */
            border-color: #e2e8f0; /* slate-300 */
        }
        .flight-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .flight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
        .spinner {
            border-top-color: #3498db;
            animation: spinner 0.6s linear infinite;
        }
        @keyframes spinner {
            to {
                transform: rotate(360deg);
            }
        }
        .prose ul ul {
            margin-top: 0.25em;
            margin-bottom: 0.25em;
        }
        .todo-item.completed span {
            text-decoration: line-through;
            color: #a1a1aa; /* stone-400 */
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-700 antialiased">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-5xl">
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-sky-700">å°ç£ â‡„ å†°å³¶ å¤¢å¹»èˆªç­è¡Œç¨‹ (9/26å»-10/7æŠµå°)</h1>
            <p class="text-stone-600 mt-2">æ‚¨çš„å°ˆå±¬èˆªç­è¨ˆç•«ï¼Œä¸€ç›®äº†ç„¶ï¼Œè¼•é¬†å•Ÿç¨‹ï¼</p>
        </header>

        <main>
            <div class="mb-6 sm:mb-8">
                <div class="border-b border-stone-300">
                    <nav class="-mb-px flex space-x-1 sm:space-x-2 md:space-x-4 justify-center" aria-label="Main Tabs">
                        <button id="main-tab-outbound" class="main-tab-active whitespace-nowrap py-3 px-2 sm:px-4 md:px-6 border-b-2 font-medium text-xs sm:text-sm md:text-base rounded-t-md focus:outline-none">
                            âœˆï¸ å»ç¨‹èˆªç­
                        </button>
                        <button id="main-tab-iceland" class="main-tab-inactive whitespace-nowrap py-3 px-2 sm:px-4 md:px-6 border-b-2 font-medium text-xs sm:text-sm md:text-base rounded-t-md hover:text-sky-600 hover:border-sky-300 focus:outline-none">
                            ğŸ‡®ğŸ‡¸ å†°å³¶æ¯æ—¥è¡Œç¨‹
                        </button>
                        <button id="main-tab-return" class="main-tab-inactive whitespace-nowrap py-3 px-2 sm:px-4 md:px-6 border-b-2 font-medium text-xs sm:text-sm md:text-base rounded-t-md hover:text-sky-600 hover:border-sky-300 focus:outline-none">
                            ğŸ  å›ç¨‹èˆªç­
                        </button>
                    </nav>
                </div>
            </div>

            <div id="main-content-area">
                <div id="content-outbound" class="main-tab-content-panel">
                    <nav class="flex space-x-2 mb-4 border-b border-slate-200 pb-2">
                        <button data-target="content-outbound-details" class="sub-tab-outbound sub-tab-active px-3 py-2 text-sm font-medium rounded-md">èˆªç­è©³æƒ…</button>
                        <button data-target="content-outbound-seattle" class="sub-tab-outbound sub-tab-inactive px-3 py-2 text-sm font-medium rounded-md">è¥¿é›…åœ– (éå¢ƒ)</button>
                    </nav>
                    <div id="content-outbound-details" class="sub-tab-content">
                        <section class="mb-8">
                            <h2 class="text-2xl font-semibold text-sky-700 mb-1">å•Ÿç¨‹ï¼šè¸ä¸Šå†°å³¶çš„å¥‡å¹»æ—…ç¨‹</h2>
                            <p class="text-stone-600 mb-6">ä»¥ä¸‹æ˜¯æ‚¨å¾å°ç£å‡ºç™¼ï¼Œç¶“è¥¿é›…åœ–è½‰æ©Ÿå‰å¾€å†°å³¶çš„èˆªç­è©³ç´°è³‡è¨Šã€‚</p>
                            <div id="outbound-flights-container" class="space-y-6"></div>
                        </section>
                    </div>
                    <div id="content-outbound-seattle" class="sub-tab-content hidden">
                        <section class="mb-8 p-4 bg-white rounded-lg shadow">
                            <h3 class="text-xl font-semibold text-sky-700 mb-3">è¥¿é›…åœ–éå¢ƒ (å»ç¨‹ï¼š9/26å‚æ™š - 9/27ä¸‹åˆ)</h3>
                            <p class="text-stone-600 mb-2">æ‚¨å°‡åœ¨è¥¿é›…åœ–åœç•™ç´„26å°æ™‚50åˆ†é˜ã€‚é€™æ®µæ™‚é–“æ‚¨å¯ä»¥ï¼š</p>
                            <ul class="list-disc pl-5 text-stone-600 space-y-1">
                                <li>é è¨‚æ©Ÿå ´é™„è¿‘çš„é£¯åº—å¥½å¥½ä¼‘æ¯ã€‚</li>
                                <li>è‹¥æ™‚é–“å……è£•ä¸”ç²¾åŠ›è¨±å¯ï¼Œå¯è€ƒæ…®æ­ä¹˜è¼•è»Œå‰å¾€å¸‚å€é€²è¡ŒçŸ­æš«è§€å…‰ (ä¾‹å¦‚ï¼šæ´¾å…‹å¸‚å ´ã€å¤ªç©ºé‡å¡”é™„è¿‘)ã€‚</li>
                                <li>ç¢ºä¿å·²è¾¦å¦¥ç¾åœ‹ESTAã€‚</li>
                                <li><strong class="text-amber-600">åœ¨æ­¤è™•è¨˜éŒ„æ‚¨çš„è¥¿é›…åœ–ä½å®¿ã€äº¤é€šæˆ–ç°¡è¦è¨ˆç•«...</strong></li>
                            </ul>
                             <textarea placeholder="è¼¸å…¥æ‚¨åœ¨è¥¿é›…åœ–å»ç¨‹éå¢ƒçš„ç­†è¨˜..." class="mt-4 w-full p-2 border border-stone-300 rounded-md h-32 focus:ring-sky-500 focus:border-sky-500"></textarea>
                        </section>
                    </div>
                </div>

                <div id="content-iceland" class="main-tab-content-panel hidden">
                    <section class="mb-8">
                        <h2 class="text-2xl font-semibold text-teal-600 mb-1">ğŸ‡®ğŸ‡¸ å†°å³¶æ¯æ—¥è¡Œç¨‹ (9/28 - 10/5)</h2>
                        <p class="text-stone-600 mb-4">è¦åŠƒæ‚¨åœ¨å†°å³¶çš„æ¯ä¸€å¤©ï¼é»æ“Šä¸‹æ–¹æ—¥æœŸæŸ¥çœ‹æˆ–ç·¨è¼¯ç•¶æ—¥è¡Œç¨‹ã€‚</p>
                        <nav id="iceland-daily-nav" class="flex flex-wrap gap-2 mb-4 pb-2 border-b border-slate-200">
                            </nav>
                        <div id="iceland-daily-content-area">
                            </div>
                    </section>
                </div>

                <div id="content-return" class="main-tab-content-panel hidden">
                     <nav class="flex space-x-2 mb-4 border-b border-slate-200 pb-2">
                        <button data-target="content-return-details" class="sub-tab-return sub-tab-active px-3 py-2 text-sm font-medium rounded-md">èˆªç­è©³æƒ…</button>
                        <button data-target="content-return-seattle" class="sub-tab-return sub-tab-inactive px-3 py-2 text-sm font-medium rounded-md">è¥¿é›…åœ– (éå¢ƒ)</button>
                    </nav>
                    <div id="content-return-details" class="sub-tab-content">
                        <section class="mb-8">
                            <h2 class="text-2xl font-semibold text-sky-700 mb-1">æ­¸é€”ï¼šæ»¿è¼‰å›æ†¶è¿”å›å®¶åœ’</h2>
                            <p class="text-stone-600 mb-6">çµæŸäº†é›£å¿˜çš„å†°å³¶ä¹‹æ—…ï¼Œé€™æ˜¯æ‚¨è¿”å›å°ç£çš„èˆªç­å®‰æ’ã€‚</p>
                            <div id="return-flights-container" class="space-y-6"></div>
                        </section>
                    </div>
                     <div id="content-return-seattle" class="sub-tab-content hidden">
                        <section class="mb-8 p-4 bg-white rounded-lg shadow">
                            <h3 class="text-xl font-semibold text-sky-700 mb-3">è¥¿é›…åœ–éå¢ƒ (å›ç¨‹ï¼š10/5å‚æ™š - 10/6å‡Œæ™¨)</h3>
                            <p class="text-stone-600 mb-2">æ‚¨å°‡åœ¨è¥¿é›…åœ–åœç•™ç´„4å°æ™‚35åˆ†é˜ã€‚é€™æ®µæ™‚é–“ä¸»è¦ç”¨æ–¼æ©Ÿå ´å…§è½‰æ©Ÿï¼š</p>
                             <ul class="list-disc pl-5 text-stone-600 space-y-1">
                                <li>éµå¾ªæ©Ÿå ´æŒ‡ç¤ºå‰å¾€ä¸‹ä¸€æ®µèˆªç­çš„ç™»æ©Ÿé–€ã€‚</li>
                                <li>è‹¥æœ‰éœ€è¦ï¼Œå¯åœ¨æ©Ÿå ´å…ç¨…åº—ç¨ä½œåœç•™ã€‚</li>
                                <li><strong class="text-amber-600">åœ¨æ­¤è™•è¨˜éŒ„æ‚¨çš„è¥¿é›…åœ–å›ç¨‹éå¢ƒçš„æ³¨æ„äº‹é …...</strong></li>
                            </ul>
                            <textarea placeholder="è¼¸å…¥æ‚¨åœ¨è¥¿é›…åœ–å›ç¨‹éå¢ƒçš„ç­†è¨˜..." class="mt-4 w-full p-2 border border-stone-300 rounded-md h-32 focus:ring-sky-500 focus:border-sky-500"></textarea>
                        </section>
                    </div>
                </div>
            </div>

            <section class="bg-sky-50 p-6 rounded-lg shadow-md mb-8 border border-sky-200">
                <h2 class="text-2xl font-semibold text-sky-700 mb-4">ğŸ“Š è¡Œç¨‹ç¸½è¦½èˆ‡é ä¼°</h2>
                <div class="space-y-3 text-stone-700">
                    <div>
                        <span class="font-medium">é ä¼°æ©Ÿç¥¨ç¸½é‡‘é¡ï¼š</span>
                        <span class="font-bold text-orange-600">NTD $41,555</span>
                        <p class="text-xs text-stone-500 mt-1">ï¼ˆæ­¤ç‚ºé ä¼°ç¸½é‡‘é¡ï¼Œæœªå«å…¶ä»–å¯èƒ½è²»ç”¨å¦‚æ©Ÿå ´ç¨…ã€è¡Œæè²»ã€åŒ¯ç‡æµ®å‹•ç­‰ï¼Œå¯¦éš›é‡‘é¡è«‹ä¾è¨‚ç¥¨æ™‚ç‚ºæº–ã€‚ï¼‰</p>
                    </div>
                    <div>
                        <span class="font-medium">ç¾åœ‹ç°½è­‰ESTAè²»ç”¨ï¼š</span>
                        <span class="font-bold text-orange-600">USD $21</span>
                         <p class="text-xs text-stone-500 mt-1">ï¼ˆæ­¤ç‚ºé ä¼°è²»ç”¨ï¼Œå¯¦éš›é‡‘é¡è«‹ä¾ç”³è«‹æ™‚å®˜æ–¹å…¬å‘Šç‚ºæº–ã€‚ï¼‰</p>
                    </div>
                    <div>
                        <span class="font-medium">å»ºè­°è«‹å‡å¤©æ•¸ï¼š</span>
                        <span class="font-bold text-sky-600">5å¤©åŠ</span>
                         <p class="text-xs text-stone-500 mt-1">ï¼ˆä¾æ“š2025/09/26å‡ºç™¼ï¼Œ2025/10/07æŠµå°ï¼Œ10/08ä¸Šç­ä¼°ç®—ã€‚æ­¤å¤©æ•¸åŒ…å«9/26ä¸‹åˆå‡ºç™¼åŠ10/6å…¨å¤©ã€‚ï¼‰</p>
                    </div>
                </div>
            </section>

            <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-semibold text-sky-700 mb-1">âœ¨ æ—…ç¨‹å°å¹«æ‰‹</h2>
                <p class="text-stone-600 mb-6">ç‚ºæ‚¨çš„å†°å³¶ä¹‹æ—…æä¾›æ›´å¤šéˆæ„Ÿèˆ‡å¯¦ç”¨å»ºè­°ï¼Œä¸¦ç®¡ç†æ‚¨çš„è¡Œå‰æº–å‚™ï¼</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button id="btn-activity-ideas" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50">
                        ğŸ’¡ æ´»å‹•éˆæ„Ÿ (AI)
                    </button>
                    <button id="btn-packing-list" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-opacity-50">
                        ğŸ’ æ‰“åŒ…å»ºè­° (ç²¾é¸)
                    </button>
                    <button id="btn-todo-list" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-opacity-50">
                        ğŸ“‹ è¡Œå‰å¾…è¾¦æ¸…å–®
                    </button>
                </div>
            </section>

            <section class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold text-sky-700 mb-4">ğŸ“Œ é‡è¦æ³¨æ„äº‹é …</h2>
                <div class="prose prose-stone max-w-none text-stone-600 space-y-3">
                    <p>æ­¤è™•æ•´ç†äº†æ‚¨è¦åŠƒè¡Œç¨‹æ™‚éœ€è¦ç‰¹åˆ¥ç•™æ„çš„è³‡è¨Šï¼Œè«‹ä»”ç´°é–±è®€ï¼Œç¢ºä¿æ—…ç¨‹é †åˆ©æ„‰å¿«ã€‚</p>
                    <ul id="important-notes-list" class="list-disc pl-5 space-y-2"></ul>
                </div>
            </section>
        </main>

        <footer class="mt-12 text-center text-sm text-stone-500">
            <p>&copy; <span id="currentYear"></span> æ‚¨çš„å°ˆå±¬è¡Œç¨‹è¦åŠƒ. ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼</p>
        </footer>
    </div>

    <div id="general-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto transform scale-95">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-xl font-semibold text-sky-700">AI å»ºè­°</h3>
                <button id="modal-close-btn" class="text-stone-500 hover:text-stone-700 text-2xl focus:outline-none">&times;</button>
            </div>
            <div id="modal-body">
                <div id="modal-loading" class="flex flex-col items-center justify-center py-8 hidden">
                    <div class="spinner w-12 h-12 rounded-full border-4 border-stone-200"></div>
                    <p class="mt-3 text-stone-600">æ­£åœ¨å‘ AI æŸ¥è©¢ï¼Œè«‹ç¨å€™...</p>
                </div>
                <div id="modal-response" class="prose prose-stone max-w-none text-stone-600"></div>
                <div id="modal-error" class="text-red-600 bg-red-100 p-3 rounded-md hidden"></div>
            </div>
        </div>
    </div>

    <script>
        const flightData = {
            outbound: [
                { segmentName: "1. å°ç£ â†’ è¥¿é›…åœ–", airline: "æ˜Ÿå®‡èˆªç©º JX32", origin: { name: "å°ç£æ¡ƒåœ’", code: "TPE", flag: "ğŸ‡¹ğŸ‡¼" }, destination: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, departureDateTime: "2025/09/26 (é€±äº”) æ™šä¸Š 08:10", arrivalDateTime: "2025/09/26 (é€±äº”) ä¸‹åˆ 04:10", cost: "NTD$12648", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„11å°æ™‚ã€‚" },
                { segmentName: "2. è¥¿é›…åœ– â†’ å†°å³¶", airline: "å†°å³¶èˆªç©º  FI682", origin: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, destination: { name: "å†°å³¶å‡±å¤«æ‹‰ç¶­å…‹", code: "KEF", flag: "ğŸ‡®ğŸ‡¸" }, departureDateTime: "2025/09/27 (é€±å…­) ä¸‹åˆ 07:00", arrivalDateTime: "2025/09/28 (é€±æ—¥) æ—©ä¸Š 09:25", cost: "USD$257.6", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„7.5å°æ™‚ã€‚<br>è¥¿é›…åœ–è½‰æ©Ÿæ™‚é–“ç´„26å°æ™‚50åˆ†ï¼Œéœ€åœ¨è¥¿é›…åœ–éå¤œã€‚" }
            ],
            return: [
                { segmentName: "3. å†°å³¶ â†’ è¥¿é›…åœ–", airline: "å†°å³¶èˆªç©º FI683", origin: { name: "å†°å³¶å‡±å¤«æ‹‰ç¶­å…‹", code: "KEF", flag: "ğŸ‡®ğŸ‡¸" }, destination: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, departureDateTime: "2025/10/05 (é€±æ—¥) æ™šä¸Š 07:45", arrivalDateTime: "2025/10/05 (é€±æ—¥) æ™šä¸Š 08:40", cost: "ç´„USD$290", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„7å°æ™‚55åˆ†é˜ã€‚" },
                { segmentName: "4. è¥¿é›…åœ– â†’ å°ç£", airline: "æ˜Ÿå®‡èˆªç©º JX31", origin: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, destination: { name: "å°ç£æ¡ƒåœ’", code: "TPE", flag: "ğŸ‡¹ğŸ‡¼" }, departureDateTime: "2025/10/06 (é€±ä¸€) å‡Œæ™¨ 01:15", arrivalDateTime: "2025/10/07 (é€±äºŒ) å‡Œæ™¨ 04:55", cost: "NTD$11168", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„12å°æ™‚40åˆ†ã€‚<br>è¥¿é›…åœ–è½‰æ©Ÿæ™‚é–“ç´„4å°æ™‚35åˆ†é˜ã€‚<br>10/7å‡Œæ™¨æŠµå°ï¼Œç•¶æ—¥éœ€ä¸Šç­ï¼Œå¯è‡ªè¡Œè«‹å‡ï¼Œè«‹æ³¨æ„ä¼‘æ¯ã€‚" }
            ],
            importantNotes: [
                "ç°½è­‰èˆ‡è­·ç…§ï¼šè«‹å‹™å¿…ç¢ºèªæ‚¨çš„è­·ç…§æ•ˆæœŸï¼ˆé€šå¸¸å»ºè­°è¡Œç¨‹çµæŸå¾Œä»æœ‰6å€‹æœˆä»¥ä¸Šæ•ˆæœŸï¼‰ï¼Œä¸¦æå‰è¾¦ç†æ‰€éœ€ç°½è­‰ï¼ˆç¾åœ‹ESTAåŠç”³æ ¹ç°½è­‰ï¼‰ã€‚",
                { 
                    type: "voltage_plug",
                    text: "é›»å£“èˆ‡æ’åº§ï¼šå†°å³¶çš„æ¨™æº–é›»å£“ç‚º 220Vï¼Œé »ç‡ç‚º 50Hzã€‚æ’åº§é¡å‹ç‚º F å‹ï¼ˆé›™åœ“å­”ï¼Œä¹Ÿç¨±ç‚º Schukoï¼‰ï¼Œæ­¤é¡å‹æ’åº§äº¦ç›¸å®¹æ–¼ C å‹å’Œ E å‹æ’é ­ã€‚å»ºè­°æ”œå¸¶é€šç”¨è½‰æ›æ’é ­ä»¥å‚™ä¸æ™‚ä¹‹éœ€ã€‚",
                    imageUrl: "https://raw.githubusercontent.com/kellywukelly/0926-1007/main/Steckdose.jpg", 
                    imageAlt: "F å‹ (Schuko) æ’åº§èˆ‡æ’é ­ç¤ºæ„åœ–"
                },
                "è½‰æ©Ÿï¼šåœ‹éš›è½‰æ©Ÿè«‹é ç•™å……è¶³æ™‚é–“ï¼Œç‰¹åˆ¥æ˜¯ä¸åŒèˆªç©ºå…¬å¸ã€‚",
                "ä½å®¿èˆ‡ç•¶åœ°äº¤é€šï¼šåˆ¥å¿˜äº†é è¨‚åœ¨è¥¿é›…åœ–ï¼ˆè‹¥éå¤œï¼‰åŠå†°å³¶çš„ä½å®¿èˆ‡ç•¶åœ°äº¤é€šã€‚",
                "æ—…éŠä¿éšªï¼šå¼·çƒˆå»ºè­°è³¼è²·æ—…éŠå¹³å®‰éšªåŠæ—…éŠä¸ä¾¿éšªã€‚"
            ],
            icelandDays: ["2025/09/28", "2025/09/29", "2025/09/30", "2025/10/01", "2025/10/02", "2025/10/03", "2025/10/04", "2025/10/05"]
        };

        const preGeneratedPackingList = `
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">è¡£ç‰© (æ´‹è”¥å¼ç©¿æ­ç‚ºä½³)ï¼š</h4>
            <ul class="list-disc pl-5 space-y-1 mb-4">
                <li><strong>åº•å±¤ (å¸æ¿•æ’æ±—):</strong> <ul class="list-circle pl-5 space-y-0.5"><li>ä¿æš–å…§è¡£è¤² (ç¾Šæ¯›æˆ–æ©Ÿèƒ½æ€§æè³ªï¼Œ2-3å¥—)</li><li>é•·è¢–æ’æ±—è¡« (2-3ä»¶)</li></ul></li>
                <li><strong>ä¸­å±¤ (ä¿æš–):</strong> <ul class="list-circle pl-5 space-y-0.5"><li>åˆ·æ¯›å¤–å¥— (Fleece jacketï¼Œ1-2ä»¶)</li><li>è¼•ç¾½çµ¨å¤–å¥—æˆ–èƒŒå¿ƒ (æ–¹ä¾¿æ”œå¸¶ï¼Œ1ä»¶)</li><li>ç¾Šæ¯›è¡« (1-2ä»¶)</li></ul></li>
                <li><strong>å¤–å±¤ (é˜²é¢¨é˜²æ°´):</strong> <ul class="list-circle pl-5 space-y-0.5"><li>Gore-Tex æˆ–é¡ä¼¼æè³ªçš„é˜²æ°´é˜²é¢¨å¤–å¥— (æœ‰å¸½ä½³ï¼Œå¿…å‚™)</li><li>é˜²æ°´é˜²é¢¨é•·è¤² (é›¨è¤²æˆ–é›ªè¤²ï¼Œå¿…å‚™)</li></ul></li>
                <li><strong>ä¸€èˆ¬è¡£ç‰©:</strong> <ul class="list-circle pl-5 space-y-0.5"><li>ä¼‘é–’é•·è¤² (å¿«ä¹¾æè³ªç‚ºä½³ï¼Œ1-2æ¢ï¼Œé¿å…ç‰›ä»”è¤²æ·‹æ¿•å¾Œé›£ä¹¾)</li><li>èˆ’é©ä¸Šè¡£ (ç”¨æ–¼å®¤å…§æˆ–è¼ƒæº«æš–æ™‚)</li><li>ç¡è¡£ (ä¿æš–å‹)</li></ul></li>
            </ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">é‹è¥ªï¼š</h4><ul class="list-disc pl-5 space-y-1 mb-4"><li><strong>é˜²æ°´ç™»å±±é‹ (é«˜ç­’ç‚ºä½³ï¼Œä¿è­·è…³è¸ä¸”é˜²æ»‘ï¼Œå¿…å‚™):</strong> å·²é¦´é‹ï¼Œé¿å…æ–°é‹ç£¨è…³ã€‚</li><li><strong>ä¿æš–ç¾Šæ¯›è¥ª (å¤šé›™):</strong> ä¿æŒè…³éƒ¨ä¹¾çˆ½æº«æš–ã€‚</li><li>è¼•ä¾¿ä¼‘é–’é‹ (ç”¨æ–¼åŸå¸‚ã€ä½å®¿é»æˆ–é£›æ©Ÿä¸Šï¼Œå¯é¸)</li></ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">é…ä»¶ï¼š</h4><ul class="list-disc pl-5 space-y-1 mb-4"><li><strong>ä¿æš–å¸½å­ (èƒ½é®ä½è€³æœµï¼Œæ¯›å¸½æˆ–é˜²é¢¨å¸½ï¼Œå¿…å‚™)</strong></li><li><strong>åœå·¾æˆ–é­”è¡“é ­å·¾ (ä¿æš–é ¸éƒ¨ï¼Œé˜²é¢¨ï¼Œå¿…å‚™)</strong></li><li><strong>é˜²æ°´ä¿æš–æ‰‹å¥— (å¿…å‚™ï¼Œå¯è€ƒæ…®å…©å±¤ï¼šè–„å…§å±¤è§¸æ§ï¼Œåšå¤–å±¤é˜²æ°´)</strong></li><li>å¤ªé™½çœ¼é¡ (é›ªåœ°æˆ–ä½è§’åº¦é™½å…‰åå°„å¼·çƒˆ)</li><li>æ³³è¡£èˆ‡å¿«ä¹¾æ¯›å·¾ (ç”¨æ–¼æº«æ³‰æˆ–åœ°ç†±æ³³æ± )</li></ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">å€‹äººç”¨å“ï¼š</h4><ul class="list-disc pl-5 space-y-1 mb-4"><li>ç›¥æ´—ç”¨å“ (ç‰™åˆ·ã€ç‰™è†ã€æ´—é¢ä¹³ã€æ´—é«®ç²¾ã€æ²æµ´ä¹³ç­‰ï¼Œéƒ¨åˆ†å†°å³¶ä½å®¿ä¸æä¾›)</li><li>ä¿é¤Šå“ (ä¿æ¿•ä¹³æ¶²ã€è­·å”‡è†ã€é˜²æ›¬ä¹³ â€“ ç´«å¤–ç·šä»å¼·)</li><li>å€‹äººè—¥å“ (æ„Ÿå†’è—¥ã€æ­¢ç—›è—¥ã€è…¸èƒƒè—¥ã€æšˆè»Šè—¥ã€OKç¹ƒåŠå€‹äººå¸¸å‚™è—¥)</li><li>è¡Œå‹•é›»æºèˆ‡å……é›»ç·š</li><li>è½‰æ›æ’é ­ (æ­æ´²è¦æ ¼ï¼ŒFå‹é›™åœ“å­”)</li><li>ç›¸æ©ŸåŠå‚™ç”¨é›»æ± ã€è¨˜æ†¶å¡</li><li>å¯é‡è¤‡ä½¿ç”¨çš„æ°´ç“¶</li><li>å°å‹å¾ŒèƒŒåŒ… (ä¸€æ—¥éŠæˆ–å¥è¡Œæ™‚ä½¿ç”¨ï¼Œæœ€å¥½æœ‰é˜²æ°´åŠŸèƒ½æˆ–èƒŒåŒ…é›¨ç½©)</li></ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">å…¶ä»–å»ºè­°ï¼š</h4><ul class="list-disc pl-5 space-y-1"><li>çœ¼ç½©ä¸è€³å¡</li><li>å°‘é‡é›¶é£Ÿ</li><li>å¡‘èƒ¶è¢‹æ•°ä¸ª</li><li>æŠ¤ç…§ã€ç­¾è¯ã€æœºç¥¨ã€ä½å®¿é¢„è®¢å•ã€é©¾ç…§ (å›½é™…é©¾ç…§)ã€ä¿¡ç”¨å¡ç­‰é‡è¦æ–‡ä»¶å½±æœ¬æˆ–ç”µå­æ¡£å¤‡ä»½</li></ul>
            <p class="mt-4 text-sm text-stone-500"><strong>æº«é¦¨æç¤ºï¼š</strong>ä¹æœˆåº•åæœˆåˆçš„å†°å³¶å¤©æ°£å¤šè®Šï¼Œæ—¥å¤œæº«å·®å¤§ï¼Œä¸”å¸¸æœ‰å¼·é¢¨åŠé™é›¨ã€‚è«‹å‹™å¿…æ¡å–æ´‹è”¥å¼ç©¿æ­ï¼Œä¸¦éš¨æ™‚æ³¨æ„å¤©æ°£é å ±èª¿æ•´è¡£ç‰©ã€‚</p>
        `;

        let todos = [];
        const TODO_STORAGE_KEY = 'icelandTripToDoList';

        function createFlightCard(flight) {
            return `
                <div class="flight-card bg-white p-5 sm:p-6 rounded-lg shadow-lg border border-stone-200 hover:border-sky-300">
                    <h3 class="text-xl font-semibold text-sky-700 mb-3">${flight.segmentName}</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 text-sm text-stone-600">
                        <div><p class="font-medium text-stone-800">âœˆï¸ èˆªç©ºå…¬å¸/èˆªç­ï¼š</p><p>${flight.airline}</p></div>
                        <div><p class="font-medium text-stone-800">ğŸ’° é‡‘é¡ (é ä¼°)ï¼š</p><p class="text-orange-600 font-semibold">${flight.cost}</p></div>
                        <div class="sm:col-span-2 border-t border-stone-200 pt-4 mt-2"><div class="flex items-center justify-between space-x-2 sm:space-x-4">
                            <div class="text-center flex-1"><p class="text-xs text-stone-500">å‡ºç™¼</p><p class="font-semibold text-lg text-sky-600">${flight.origin.flag} ${flight.origin.code}</p><p class="text-xs">${flight.origin.name}</p><p class="text-xs mt-1">${flight.departureDateTime}</p></div>
                            <div class="text-stone-400 text-2xl font-light self-center pb-5 sm:pb-6">â†’</div>
                            <div class="text-center flex-1"><p class="text-xs text-stone-500">æŠµé”</p><p class="font-semibold text-lg text-sky-600">${flight.destination.flag} ${flight.destination.code}</p><p class="text-xs">${flight.destination.name}</p><p class="text-xs mt-1">${flight.arrivalDateTime}</p></div>
                        </div></div>
                        <div class="sm:col-span-2 mt-2"><p class="font-medium text-stone-800">ğŸ“ å‚™è¨»ï¼š</p><p class="prose prose-sm max-w-none">${flight.remarks.replace(/<br>/g, '<br>')}</p></div>
                    </div>
                </div>`;
        }

        const generalModal = document.getElementById('general-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalLoading = document.getElementById('modal-loading');
        const modalResponse = document.getElementById('modal-response');
        const modalError = document.getElementById('modal-error');

        function showModal(title, contentHTML = '', isStaticContent = false, isToDoList = false) {
            modalTitle.textContent = title;
            modalResponse.innerHTML = contentHTML;
            modalError.classList.add('hidden');
            modalError.textContent = '';
            modalLoading.classList.add('hidden'); 
            if (!isStaticContent && !isToDoList) { 
                modalLoading.classList.remove('hidden');
            }
            generalModal.classList.remove('hidden');
            setTimeout(() => generalModal.classList.remove('opacity-0'), 10);
            setTimeout(() => document.querySelector('.modal-content').classList.remove('scale-95'), 10);
        }

        function hideModal() {
            generalModal.classList.add('opacity-0');
            document.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => generalModal.classList.add('hidden'), 250);
        }

        modalCloseBtn.addEventListener('click', hideModal);
        generalModal.addEventListener('click', (event) => {
            if (event.target === generalModal) hideModal();
        });

        async function callGeminiAPI(prompt) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API è«‹æ±‚å¤±æ•—ï¼Œç‹€æ…‹ç¢¼ï¼š${response.status}. ${errorData?.error?.message || 'æœªçŸ¥éŒ¯èª¤'}`);
                }
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error('å¾ API æ”¶åˆ°çš„å›æ‡‰æ ¼å¼ä¸ç¬¦é æœŸã€‚');
                }
            } catch (error) {
                console.error('å‘¼å« Gemini API æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                throw error;
            }
        }
        
        function setupSubTabs(mainTabContentId, subTabButtonClass, defaultActiveTarget) {
            const subTabButtons = document.querySelectorAll(`#${mainTabContentId} .${subTabButtonClass}`);
            const subTabContents = document.querySelectorAll(`#${mainTabContentId} .sub-tab-content`);

            subTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    subTabButtons.forEach(btn => {
                        btn.classList.remove('sub-tab-active');
                        btn.classList.add('sub-tab-inactive');
                    });
                    button.classList.remove('sub-tab-inactive');
                    button.classList.add('sub-tab-active');

                    const targetId = button.dataset.target;
                    subTabContents.forEach(content => {
                        if (content.id === targetId) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });
            if (defaultActiveTarget) {
                document.querySelector(`#${mainTabContentId} button[data-target='${defaultActiveTarget}']`)?.click();
            }
        }

        function setupIcelandDailyTabs() {
            const navContainer = document.getElementById('iceland-daily-nav');
            const contentArea = document.getElementById('iceland-daily-content-area');
            navContainer.innerHTML = ''; 
            contentArea.innerHTML = ''; 

            flightData.icelandDays.forEach((dateStr, index) => {
                const dateObj = new Date(dateStr);
                const day = String(dateObj.getDate()).padStart(2, '0');
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const shortDate = `${month}/${day}`;
                const contentId = `content-iceland-day-${month}${day}`;

                const button = document.createElement('button');
                button.textContent = shortDate;
                button.dataset.target = contentId;
                button.className = `sub-tab-iceland-day ${index === 0 ? 'sub-tab-active' : 'sub-tab-inactive'} px-3 py-2 text-sm font-medium rounded-md border`;
                navContainer.appendChild(button);

                const div = document.createElement('div');
                div.id = contentId;
                div.className = `sub-tab-content p-4 bg-white rounded-lg shadow ${index !== 0 ? 'hidden' : ''}`;
                div.innerHTML = `
                    <h4 class="text-lg font-semibold text-teal-700 mb-3">å†°å³¶ ${dateStr} (${['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][dateObj.getDay()]}) è¡Œç¨‹</h4>
                    <p class="text-stone-500 mb-2">æ‚¨å¯ä»¥åœ¨é€™è£¡è¨˜éŒ„ç•¶å¤©çš„ä½å®¿ã€æ™¯é»ã€é¤å»³ã€æ´»å‹•ç­‰è¨ˆç•«ã€‚</p>
                    <textarea placeholder="è¼¸å…¥ ${shortDate} çš„è¡Œç¨‹ç­†è¨˜..." class="w-full p-2 border border-stone-300 rounded-md h-48 focus:ring-teal-500 focus:border-teal-500"></textarea>
                `;
                contentArea.appendChild(div);
            });
            
            const dailyTabs = document.querySelectorAll('.sub-tab-iceland-day');
            dailyTabs.forEach(button => {
                button.addEventListener('click', () => {
                    dailyTabs.forEach(btn => {
                        btn.classList.remove('sub-tab-active');
                        btn.classList.add('sub-tab-inactive');
                    });
                    button.classList.remove('sub-tab-inactive');
                    button.classList.add('sub-tab-active');
                    
                    document.querySelectorAll('#iceland-daily-content-area .sub-tab-content').forEach(content => content.classList.add('hidden'));
                    document.getElementById(button.dataset.target).classList.remove('hidden');
                });
            });
             if (dailyTabs.length > 0) {
                dailyTabs[0].click(); 
            }
        }


        document.getElementById('btn-activity-ideas').addEventListener('click', async () => {
            showModal('ğŸ’¡ å†°å³¶æ´»å‹•éˆæ„Ÿ (AI æ”¯æ´)');
            const prompt = "æˆ‘å°‡åœ¨9æœˆåº•åˆ°10æœˆåˆå‰å¾€å†°å³¶æ—…éŠã€‚è«‹æ¨è–¦ä¸€äº›é©åˆé€™å€‹å­£ç¯€åœ¨å†°å³¶é€²è¡Œçš„æ´»å‹•å’Œå€¼å¾—æ¢è¨ªçš„æ™¯é»ã€‚è«‹ä»¥æ¢åˆ—å¼æ¸…å–®æ–¹å¼å‘ˆç¾ï¼Œä¸¦ç°¡çŸ­æè¿°æ¯å€‹é …ç›®ã€‚";
            try {
                const ideasText = await callGeminiAPI(prompt);
                modalResponse.innerHTML = ideasText.split('\n').map(line => {
                    const trimmedLine = line.replace(/^[\-\*]\s*/, '').trim();
                    if(trimmedLine) return `<p>${trimmedLine}</p>`;
                    return '';
                }).join('');
            } catch (error) {
                modalError.textContent = `ç„¡æ³•å–å¾—æ´»å‹•å»ºè­°ï¼š${error.message}`;
                modalError.classList.remove('hidden');
            } finally {
                modalLoading.classList.add('hidden');
            }
        });

        document.getElementById('btn-packing-list').addEventListener('click', () => {
            showModal('ğŸ’ è¡Œææ‰“åŒ…å»ºè­° (ç²¾é¸)', preGeneratedPackingList, true);
        });

        function loadToDos() {
            const storedToDos = localStorage.getItem(TODO_STORAGE_KEY);
            if (storedToDos) todos = JSON.parse(storedToDos);
        }

        function saveToDos() {
            localStorage.setItem(TODO_STORAGE_KEY, JSON.stringify(todos));
        }

        function renderToDoList() {
            const c = document.createElement('div');
            c.innerHTML = `<div class="flex mb-4"><input type="text" id="todo-input" placeholder="æ–°å¢å¾…è¾¦äº‹é …..." class="flex-grow p-2 border border-stone-300 rounded-l-md focus:ring-amber-500 focus:border-amber-500"><button id="add-todo-btn" class="bg-amber-500 hover:bg-amber-600 text-white p-2 rounded-r-md focus:outline-none">æ–°å¢</button></div><ul id="todo-items-list" class="space-y-2"></ul>`;
            const ul = c.querySelector('#todo-items-list');
            todos.forEach(todo => {
                const li = document.createElement('li');
                li.className = `todo-item flex items-center justify-between p-2 border-b border-stone-200 ${todo.completed ? 'completed' : ''}`;
                li.dataset.id = todo.id;
                li.innerHTML = `<input type="checkbox" ${todo.completed ? 'checked' : ''} class="form-checkbox h-5 w-5 text-amber-500 rounded focus:ring-amber-400 mr-3 cursor-pointer"><span class="flex-grow cursor-pointer">${todo.text}</span><button class="text-red-400 hover:text-red-600 font-semibold ml-3 focus:outline-none">âœ•</button>`;
                ul.appendChild(li);
            });
            c.querySelector('#add-todo-btn').addEventListener('click', () => {
                const input = c.querySelector('#todo-input');
                if (input.value.trim()) { addToDoItem(input.value.trim()); input.value = ''; }
            });
            c.querySelector('#todo-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') c.querySelector('#add-todo-btn').click(); });
            ul.addEventListener('click', (e) => {
                const li = e.target.closest('li.todo-item'); if (!li) return; const id = Number(li.dataset.id);
                if (e.target.type === 'checkbox' || e.target.tagName === 'SPAN') toggleComplete(id);
                else if (e.target.tagName === 'BUTTON') deleteToDoItem(id);
            });
            return c.innerHTML;
        }
        
        function addToDoItem(text) { todos.push({ id: Date.now(), text, completed: false }); saveToDos(); modalResponse.innerHTML = renderToDoList(); }
        function toggleComplete(id) { const t = todos.find(x => x.id === id); if (t) t.completed = !t.completed; saveToDos(); modalResponse.innerHTML = renderToDoList(); }
        function deleteToDoItem(id) { todos = todos.filter(t => t.id !== id); saveToDos(); modalResponse.innerHTML = renderToDoList(); }

        document.getElementById('btn-todo-list').addEventListener('click', () => { loadToDos(); showModal('ğŸ“‹ è¡Œå‰å¾…è¾¦æ¸…å–®', renderToDoList(), true, true); });

        document.addEventListener('DOMContentLoaded', () => {
            const outboundFlightsContainer = document.getElementById('outbound-flights-container');
            const returnFlightsContainer = document.getElementById('return-flights-container');
            const notesList = document.getElementById('important-notes-list');

            flightData.outbound.forEach(flight => outboundFlightsContainer.innerHTML += createFlightCard(flight));
            flightData.return.forEach(flight => returnFlightsContainer.innerHTML += createFlightCard(flight));
            
            notesList.innerHTML = ''; 
            flightData.importantNotes.forEach(note => {
                const li = document.createElement('li');
                if (typeof note === 'string') {
                    li.textContent = note;
                } else if (typeof note === 'object' && note.type === 'voltage_plug') {
                    li.innerHTML = `${note.text} <br><img src="${note.imageUrl}" alt="${note.imageAlt}" class="my-2 rounded-md shadow-sm max-w-xs mx-auto" style="max-height:100px;">`;
                }
                notesList.appendChild(li);
            });

            const mainTabs = [
                { btn: document.getElementById('main-tab-outbound'), content: document.getElementById('content-outbound') },
                { btn: document.getElementById('main-tab-iceland'), content: document.getElementById('content-iceland') },
                { btn: document.getElementById('main-tab-return'), content: document.getElementById('content-return') }
            ];

            mainTabs.forEach(tab => {
                tab.btn.addEventListener('click', () => {
                    mainTabs.forEach(t => {
                        t.btn.classList.remove('main-tab-active');
                        t.btn.classList.add('main-tab-inactive');
                        t.content.classList.add('hidden');
                    });
                    tab.btn.classList.remove('main-tab-inactive');
                    tab.btn.classList.add('main-tab-active');
                    tab.content.classList.remove('hidden');
                });
            });
            
            setupSubTabs('content-outbound', 'sub-tab-outbound', 'content-outbound-details');
            setupSubTabs('content-return', 'sub-tab-return', 'content-return-details');
            setupIcelandDailyTabs();

            if (mainTabs.length > 0) {
                 mainTabs[0].btn.click();
            }

            document.getElementById('currentYear').textContent = new Date().getFullYear();
            loadToDos();
        });
    </script>
</body>
</html>
