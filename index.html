<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†°å³¶æ—…ç¨‹äº’å‹•å„€è¡¨æ¿ (æœ€çµ‚æ•´åˆç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Slate & Sky (Background: slate-50, Text: slate-700, Accent: sky-600, Highlight: amber-500) -->
    <!-- Application Structure Plan: A single-page dashboard combining the best of previous versions. It uses a three-tab main navigation: "èˆªç­ç¸½è¦½" (Flight Overview), "è¡Œç¨‹æ™‚é–“è»¸" (Itinerary Timeline), and "è¦åŠƒèˆ‡æº–å‚™" (Planning & Prep). The "Flight Overview" tab isolates flight details. The "Itinerary Timeline" tab becomes the centerpiece, displaying the detailed vertical timeline for a chronological step-by-step view of the trip. The "Planning & Prep" tab consolidates all tools and auxiliary information (cost summary, assistants, important notes, car rental info, and a new souvenirs section). The to-do list is now pre-populated with unresolved items for a better user start. -->
    <!-- Visualization & Content Choices: Itinerary Data -> Goal: Organize/Follow -> Viz: Vertical Timeline with event cards. Interaction: Clickable links for external maps. Justification: Best reflects the user's detailed chronological plan. Flight Data -> Goal: Inform -> Viz: Flight cards with added terminal info. Justification: Clear and structured display. Prep Info -> Goal: Inform/Assist -> Viz: Styled cards and modal-triggered assistants. Justification: Groups tools and reference material logically. Library/Method: Vanilla JS, Tailwind. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        .main-tab-active { color: #0284c7; border-color: #0284c7; }
        .main-tab-inactive { color: #475569; border-color: transparent; }
        .timeline-container::before {
            content: ''; position: absolute; left: 50%; transform: translateX(-50%);
            top: 0; bottom: 0; width: 4px; background-color: #e2e8f0; border-radius: 2px;
        }
        .timeline-item { position: relative; width: 50%; }
        .timeline-item:nth-child(odd) { left: 0; padding-right: 2rem; text-align: right; }
        .timeline-item:nth-child(even) { left: 50%; padding-left: 2rem; text-align: left; }
        .timeline-item:nth-child(odd) .timeline-content { float: right; }
        .timeline-item:nth-child(even) .timeline-content { float: left; }
        .modal { transition: opacity 0.25s ease; }
        .modal-content { transition: transform 0.25s ease; }
        .todo-item.completed span { text-decoration: line-through; color: #94a3b8; }

        @media (max-width: 768px) {
            .timeline-container::before { left: 1.25rem; transform: translateX(-50%); }
            .timeline-item, .timeline-item:nth-child(even) { width: 100%; left: 0; padding-left: 3rem; padding-right: 0; text-align: left; }
            .timeline-item:nth-child(odd) .timeline-content, .timeline-item:nth-child(even) .timeline-content { float: none; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-12 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-sky-700">å†°å³¶æ—…ç¨‹äº’å‹•å„€è¡¨æ¿</h1>
            <p class="text-slate-600 mt-2">æ‚¨çš„å°ˆå±¬èˆªç­ã€æ™‚é–“è»¸èˆ‡è¦åŠƒå·¥å…·</p>
        </header>

        <!-- Main Tabs Navigation -->
        <div class="mb-8 border-b border-slate-300">
            <nav class="-mb-px flex space-x-2 sm:space-x-6 justify-center" aria-label="Main Tabs">
                <button data-tab="flights" class="main-tab-inactive whitespace-nowrap py-3 px-3 sm:px-4 border-b-2 font-semibold text-sm sm:text-base focus:outline-none">âœˆï¸ èˆªç­ç¸½è¦½</button>
                <button data-tab="timeline" class="main-tab-active whitespace-nowrap py-3 px-3 sm:px-4 border-b-2 font-semibold text-sm sm:text-base focus:outline-none">ğŸ—ºï¸ è¡Œç¨‹æ™‚é–“è»¸</button>
                <button data-tab="prep" class="main-tab-inactive whitespace-nowrap py-3 px-3 sm:px-4 border-b-2 font-semibold text-sm sm:text-base focus:outline-none">ğŸ› ï¸ è¦åŠƒèˆ‡æº–å‚™</button>
            </nav>
        </div>

        <!-- Main Content Area -->
        <main>
            <!-- Flights Tab -->
            <div id="flights-content" class="tab-panel hidden">
                 <h2 class="text-2xl font-bold text-slate-700 mb-6 text-center">èˆªç­èˆ‡éå¢ƒè³‡è¨Š</h2>
                 <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-semibold text-sky-700 mb-4 border-l-4 border-sky-500 pl-3">å»ç¨‹èˆªç­</h3>
                        <div id="outbound-flights-container" class="space-y-6"></div>
                    </div>
                     <div>
                        <h3 class="text-xl font-semibold text-sky-700 mb-4 border-l-4 border-sky-500 pl-3">å›ç¨‹èˆªç­</h3>
                        <div id="return-flights-container" class="space-y-6"></div>
                    </div>
                 </div>
            </div>

            <!-- Timeline Tab -->
            <div id="timeline-content" class="tab-panel">
                 <h2 class="text-2xl font-bold text-slate-700 mb-6 text-center">è¡Œç¨‹æ™‚é–“è»¸</h2>
                 <div id="timeline-container" class="relative timeline-container py-8">
                    <!-- Timeline items will be injected here by JavaScript -->
                </div>
            </div>

            <!-- Prep & Info Tab -->
            <div id="prep-content" class="tab-panel hidden">
                <h2 class="text-2xl font-bold text-slate-700 mb-6 text-center">è¦åŠƒèˆ‡æº–å‚™ä¸­å¿ƒ</h2>
                <div class="space-y-8">
                    <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-sky-500">
                        <h3 class="text-xl font-semibold text-sky-700 mb-4">ğŸ“Š è¡Œç¨‹ç¸½è¦½èˆ‡é ä¼°</h3>
                        <div class="space-y-3 text-slate-600">
                            <div><span class="font-medium">ä¾†å›æ©Ÿç¥¨ç¸½é‡‘é¡ï¼š</span><strong class="text-orange-600">NTD $41,555</strong></div>
                            <div><span class="font-medium">ç¾åœ‹ç°½è­‰ESTAè²»ç”¨ï¼š</span><strong class="text-orange-600">USD $21</strong></div>
                            <div><span class="font-medium">è«‹å‡å¤©æ•¸ï¼š</span><strong class="text-sky-600">5å¤©åŠ</strong> (ä¾æ“š9/26ä¸‹åˆå‡ºç™¼ï¼Œ10/7æŠµå°ä¼°ç®—)</div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-amber-500">
                        <h3 class="text-xl font-semibold text-amber-700 mb-4">âœ¨ æ—…ç¨‹å°å¹«æ‰‹</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <button id="btn-activity-ideas" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition">ğŸ’¡ æ´»å‹•éˆæ„Ÿ (AI)</button>
                            <button id="btn-packing-list" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition">ğŸ’ æ‰“åŒ…å»ºè­°</button>
                            <button id="btn-todo-list" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition">ğŸ“‹ å¾…è¾¦æ¸…å–®</button>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-cyan-500">
                        <h3 class="text-xl font-semibold text-cyan-700 mb-4">ğŸ“„ æ´»å‹•é è¨‚è³‡è¨Š</h3>
                        <div id="bookings-container" class="space-y-6"></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-emerald-500">
                        <h3 class="text-xl font-semibold text-emerald-700 mb-4">ğŸ å†°å³¶å¿…è²·ä¼´æ‰‹ç¦®</h3>
                        <div id="souvenirs-container" class="prose prose-slate max-w-none text-slate-600"></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-slate-500">
                        <h3 class="text-xl font-semibold text-slate-700 mb-4">ğŸ“Œ é‡è¦æ³¨æ„äº‹é …</h3>
                        <div id="important-notes-container" class="prose prose-slate max-w-none text-slate-600"></div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="mt-12 text-center text-sm text-slate-500">
            <p>&copy; <span id="currentYear"></span> æ‚¨çš„å°ˆå±¬è¡Œç¨‹è¦åŠƒ. ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼</p>
        </footer>
    </div>

    <!-- Modal Structure -->
    <div id="general-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto transform scale-95">
            <div class="flex justify-between items-center mb-4 border-b pb-3"><h3 id="modal-title" class="text-xl font-semibold text-sky-700">æ—…ç¨‹å°å¹«æ‰‹</h3><button id="modal-close-btn" class="text-slate-500 hover:text-slate-700 text-2xl font-bold focus:outline-none">&times;</button></div>
            <div id="modal-body" class="mt-4">
                <div id="modal-loading" class="flex flex-col items-center justify-center py-8 hidden"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600"></div><p class="mt-3 text-slate-600">æ­£åœ¨å‘ AI æŸ¥è©¢...</p></div>
                <div id="modal-response" class="prose prose-slate max-w-none text-slate-600"></div>
                <div id="modal-error" class="text-red-600 bg-red-100 p-3 rounded-md hidden"></div>
            </div>
        </div>
    </div>

    <script>
        const tripData = {
            flights: [
                { leg: 'outbound', segment: 1, segmentName: "1. å°ç£ â†’ è¥¿é›…åœ–", airline: "æ˜Ÿå®‡èˆªç©º JX32", terminal: "ç¬¬ä¸€èˆªå»ˆ", origin: { name: "å°ç£æ¡ƒåœ’", code: "TPE", flag: "ğŸ‡¹ğŸ‡¼" }, destination: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, departureDateTime: "2025/09/26 (é€±äº”) æ™šä¸Š 08:10", arrivalDateTime: "2025/09/26 (é€±äº”) ä¸‹åˆ 04:10", cost: "NTD$12648", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„11å°æ™‚ã€‚" },
                { leg: 'outbound', segment: 2, segmentName: "2. è¥¿é›…åœ– â†’ å†°å³¶", airline: "å†°å³¶èˆªç©º  FI682", terminal: "ä¸»èˆªå»ˆ (Main Terminal)", origin: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, destination: { name: "å†°å³¶å‡±å¤«æ‹‰ç¶­å…‹", code: "KEF", flag: "ğŸ‡®ğŸ‡¸" }, departureDateTime: "2025/09/27 (é€±å…­) ä¸‹åˆ 07:00", arrivalDateTime: "2025/09/28 (é€±æ—¥) æ—©ä¸Š 09:25", cost: "USD$257.6", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„7.5å°æ™‚ã€‚<br>è¥¿é›…åœ–è½‰æ©Ÿæ™‚é–“ç´„26å°æ™‚50åˆ†ï¼Œéœ€åœ¨è¥¿é›…åœ–éå¤œã€‚" },
                { leg: 'return', segment: 3, segmentName: "3. å†°å³¶ â†’ è¥¿é›…åœ–", airline: "å†°å³¶èˆªç©º FI683", terminal: "ä¸»èˆªå»ˆ (Main Terminal)", origin: { name: "å†°å³¶å‡±å¤«æ‹‰ç¶­å…‹", code: "KEF", flag: "ğŸ‡®ğŸ‡¸" }, destination: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, departureDateTime: "2025/10/05 (é€±æ—¥) æ™šä¸Š 07:45", arrivalDateTime: "2025/10/05 (é€±æ—¥) æ™šä¸Š 08:40", cost: "ç´„USD$290", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„7å°æ™‚55åˆ†é˜ã€‚" },
                { leg: 'return', segment: 4, segmentName: "4. è¥¿é›…åœ– â†’ å°ç£", airline: "æ˜Ÿå®‡èˆªç©º JX31", terminal: "ç¬¬ä¸€èˆªå»ˆ", origin: { name: "è¥¿é›…åœ–å¡”ç§‘é¦¬", code: "SEA", flag: "ğŸ‡ºğŸ‡¸" }, destination: { name: "å°ç£æ¡ƒåœ’", code: "TPE", flag: "ğŸ‡¹ğŸ‡¼" }, departureDateTime: "2025/10/06 (é€±ä¸€) å‡Œæ™¨ 01:15", arrivalDateTime: "2025/10/07 (é€±äºŒ) å‡Œæ™¨ 04:55", cost: "NTD$11168", remarks: "ç›´é£›ã€‚é£›è¡Œæ™‚é–“ç´„12å°æ™‚40åˆ†ã€‚<br>è¥¿é›…åœ–è½‰æ©Ÿæ™‚é–“ç´„4å°æ™‚35åˆ†é˜ã€‚<br>10/7å‡Œæ™¨æŠµå°ï¼Œç•¶æ—¥éœ€ä¸Šç­ï¼Œå¯è‡ªè¡Œè«‹å‡ï¼Œè«‹æ³¨æ„ä¼‘æ¯ã€‚" }
            ],
            timeline: [
                { type: 'day_header', date: '2025/09/26 (äº”)', dayLabel: 'Day 1', title: 'å•Ÿç¨‹æ—¥', events: [{ time: '20:10', type: 'flight', description: 'å°ç£æ¡ƒåœ’ (TPE) å‡ºç™¼', details: 'æ­ä¹˜æ˜Ÿå®‡èˆªç©ºå‰å¾€è¥¿é›…åœ–ã€‚<br>èˆªå»ˆ: ç¬¬ä¸€èˆªå»ˆ' }, { time: '16:10', type: 'flight_arrival', description: 'æŠµé”è¥¿é›…åœ– (SEA)', details: 'è¾¦ç†å…¥å¢ƒæ‰‹çºŒã€‚' }, { time: 'å‚æ™š', type: 'stay', description: 'å…¥ä½ åœ°ä¸­æµ·æ—…é¤¨ (Mediterranean Inn)', details: 'ç¸½åƒ¹ US$298.22', link: 'https://www.google.com/maps/search/?api=1&query=Mediterranean+Inn+Seattle' }] },
                { type: 'day_header', date: '2025/09/27 (å…­)', dayLabel: 'Day 2', title: 'è¥¿é›…åœ–è½‰æ©Ÿ', events: [{ time: 'ç™½å¤©', type: 'activity', description: 'è¥¿é›…åœ–è‡ªç”±æ´»å‹•', details: 'å¯é€²è¡Œå¸‚å€è§€å…‰æˆ–ä¼‘æ¯ã€‚' }, { time: '19:00', type: 'flight', description: 'è¥¿é›…åœ– (SEA) å‡ºç™¼', details: 'æ­ä¹˜å†°å³¶èˆªç©ºé£›å¾€å†°å³¶ (KEF)ã€‚<br>èˆªå»ˆ: ä¸»èˆªå»ˆ (Main Terminal)' }] },
                { type: 'day_header', date: '2025/09/28 (æ—¥)', dayLabel: 'å†°å³¶ Day 1', title: 'é»ƒé‡‘åœˆåˆæ¢', events: [{ time: '09:25', type: 'flight_arrival', description: 'æŠµé”å†°å³¶ (KEF)', details: 'é è¨ˆè‡³ 12:00 å®Œæˆå‡ºå¢ƒèˆ‡ç§Ÿè»Šæ‰‹çºŒã€‚<br>ç­‰è¡Œææ™‚ï¼Œå¯å»è¡Œæè¼¸é€å¸¶æ—é‚Šçš„Duty Free Shopè²·é…’ã€‚' }, { time: '12:00-13:30', type: 'drive', description: 'é–‹è»Šè‡³é»ƒé‡‘åœˆ' }, { time: '13:30-14:00', type: 'activity', description: 'ç«å£æ¹– (KeriÃ°)', link: 'https://www.google.com/maps/search/?api=1&query=Kerid+Crater' }, { time: '14:00-14:30', type: 'drive', description: 'è»Šç¨‹' }, { time: '14:30-15:30', type: 'activity', description: 'é–“æ­‡æ³‰ (Strokkur)', link: 'https://www.google.com/maps/search/?api=1&query=Strokkur+Geysir' }, { time: '15:30-15:50', type: 'drive', description: 'è»Šç¨‹' }, { time: '15:50-17:00', type: 'activity', description: 'å¤ä½›æ–¯ç€‘å¸ƒ (Gullfoss)', link: 'https://www.google.com/maps/search/?api=1&query=Gullfoss+Waterfall' }, { time: '17:00-18:00', type: 'drive', description: 'å‰å¾€éœçˆ¾æ–¯æ²ƒå¾·å‘‚çˆ¾', details: 'TESLA è¶…å……' }, { time: '18:00-19:00', type: 'food', description: 'è¶…å¸‚æ¡è²·', details: 'KrÃ³nan è¶…å¸‚ï¼Œç‡Ÿæ¥­è‡³ 19:00ã€‚', link: 'https://www.google.com/maps/search/?api=1&query=KrÃ³nan, HvolsvÃ¶llur' }, { time: '19:00 å¾Œ', type: 'stay', description: 'å…¥ä½ Asgard', details: 'åœ°å€: QQ2Q+FJ2, 860 HvolsvÃ¶llur, å†°å³¶<br>ç¸½åƒ¹: 231.84æ­å…ƒ<br>æœ‰æ´—è¡£æ©Ÿ', link: 'https://www.google.com/maps/search/?api=1&query=Asgard, QQ2Q%2BFJ2, 860 HvolsvÃ¶llur, Iceland' }] },
                { type: 'day_header', date: '2025/09/29 (ä¸€)', dayLabel: 'å†°å³¶ Day 2', title: 'å—éƒ¨æµ·å²¸è‡³å†°æ²³æ¹–', events: [{ time: '07:00-07:40', type: 'drive', description: 'è»Šç¨‹' }, { time: '07:40-08:30', type: 'activity', description: 'æ–¯ç§‘åŠ çˆ¾ç€‘å¸ƒ (å½©è™¹ç€‘å¸ƒ)', link: 'https://www.google.com/maps/search/?api=1&query=SkÃ³gafoss' }, { time: '08:30-09:00', type: 'drive', description: 'è»Šç¨‹' }, { time: '09:00-10:00', type: 'activity', description: 'é»‘æ²™ç˜ (Reynisfjara)', details: 'æ³¨æ„ç˜‹ç‹—æµªï¼', link: 'https://www.google.com/maps/search/?api=1&query=Reynisfjara+Black+Sand+Beach' }, { time: '10:00-12:00', type: 'food', description: 'ç¶­å…‹é® (VÃ­k) ç”¨é¤èˆ‡æ¡è²·', details: 'Pizza12:00é–‹ åº—æ—æœ‰ Isorka è¶…å¸‚æ—TAP&GO Instavolt' }, { time: '12:00-14:30', type: 'drive', description: 'é•·é€”é§•é§›è‡³å†°æ²³æ¹–' }, { time: '14:30-18:00', type: 'activity', description: 'å‚‘å¤æ²™é¾å†°æ²³æ¹– & é‘½çŸ³å†°æ²™ç˜', details: 'æœ‰ON å……é›»æ¨ï¼Œç”¨APPé–‹', link: 'https://www.google.com/maps/search/?api=1&query=JÃ¶kulsÃ¡rlÃ³n' }, { time: '18:00-18:30', type: 'drive', description: 'å‰å¾€ä½å®¿é»' }, { time: '18:30 å¾Œ', type: 'stay', description: 'å…¥ä½ Vagnsstadir Guesthouse', details: 'åœ°å€: F985, 781 hornafjordur, å†°å³¶<br>ç¸½åƒ¹: 282.94æ­å…ƒ', link: 'https://www.google.com/maps/search/?api=1&query=Vagnsstadir+Guesthouse' }] },
                { type: 'day_header', date: '2025/09/30 (äºŒ)', dayLabel: 'å†°å³¶ Day 3', title: 'å†°ä¸Šæ´»å‹•èˆ‡æ±éƒ¨å³½ç£', events: [{ time: '07:00-09:30', type: 'prep', description: 'èµ·åºŠã€æ—©é¤ã€å‰å¾€æ´»å‹•é»', details: '07:00èµ·åºŠ 07:30 åƒæ—©é¤' }, { time: '09:30-12:30', type: 'activity', description: 'å†°ä¸Šæ‘©æ‰˜è»Š', details: 'å·²é è¨‚ (FST-T102733345)<br>09:00è¦åˆ°å†°ä¸Šæ‘©æ‰˜è»Šæœƒåˆè™•' }, { time: '12:30-13:30', type: 'drive', description: 'è»Šç¨‹è‡³èµ«æœ¬é®' }, { time: '13:30-15:00', type: 'food', description: 'èµ«æœ¬é® (HÃ¶fn) ç”¨é¤', details: 'æ¨è–¦é¤å»³ï¼šPakkhÃºs Restaurant<br>æ—é‚Šæœ‰TESLAè¶…å……' }, { time: '15:00-15:30', type: 'drive', description: 'è»Šç¨‹è‡³è™è å±±' }, { time: '15:30-17:00', type: 'activity', description: 'è™è å±± (Vestrahorn) & ç¶­äº¬éƒ¨è½', link: 'https://www.google.com/maps/search/?api=1&query=Vestrahorn' }, { time: '17:00-19:00', type: 'drive', description: 'é•·é€”é§•é§›è‡³ä½å®¿é»' }, { time: '19:00 å¾Œ', type: 'stay', description: 'å…¥ä½ Berunes HI Hostel', details: 'æ™šé¤7:30 ISOKAå……é›»æ¨<br>ç¸½åƒ¹: 255.41æ­å…ƒ<br>ä»˜è²»æ´—è¡£', link: 'https://www.google.com/maps/search/?api=1&query=Berunes+HI+Hostel' }] },
                { type: 'day_header', date: '2025/10/01 (ä¸‰)', dayLabel: 'å†°å³¶ Day 4', title: 'æ±éƒ¨å³½ç£è‡³ç±³æ¹–', events: [{ time: '09:00-11:00', type: 'drive', description: 'è»Šç¨‹' }, { time: '11:00-11:30', type: 'activity', description: 'å¤å¤«ç€‘å¸ƒ (Gufufoss)' }, { time: '11:30-11:50', type: 'drive', description: 'è»Šç¨‹' }, { time: '11:50-15:00', type: 'food', description: 'å¡æ¿Ÿæ–¯è²å„æ¾¤ (ç™½æ—¥å¤¢å†’éšªå°é®)' }, { time: '15:00-15:30', type: 'drive', description: 'è»Šç¨‹' }, { time: '15:30-16:30', type: 'food', description: 'åŸƒä¼Šçˆ¾æ–¯å¡”æ¿Ÿå°è±¬è¶…å¸‚&Nettoæ¡è²·', details: 'N1è·ŸNettoä¸­é–“æœ‰TESLAè¶…å…… åœ°é»åœ¨N1 sjÃ¡lfsali' }, { time: '16:30-18:30', type: 'drive', description: 'é•·é€”é§•é§›è‡³ç±³æ¹–' }, { time: '18:30 å¾Œ', type: 'stay', description: 'å…¥ä½ Dimmuborgir Guesthouse', details: 'ç¸½åƒ¹: 276.69æ­å…ƒ', link: 'https://www.google.com/maps/search/?api=1&query=Dimmuborgir+Guesthouse' }] },
                { type: 'day_header', date: '2025/10/02 (å››)', dayLabel: 'å†°å³¶ Day 5', title: 'ç±³æ¹–å€åŸŸæ¢ç´¢', events: [{ time: 'ä¸Šåˆ', type: 'activity', description: 'ç¹ç±³æ¹– & èµ°æ­¥é“', link: 'https://www.google.com/maps/search/?api=1&query=Lake+MÃ½vatn' }, { time: '09:10-09:20', type: 'activity', description: 'åœ°æ´æº«æ³‰ (GrjÃ³tagjÃ¡)', link: 'https://www.google.com/maps/search/?api=1&query=GrjÃ³tagjÃ¡' }, { time: '09:30-09:50', type: 'activity', description: 'åœ°ç†±è°· (Hverir)' , link: 'https://www.google.com/maps/search/?api=1&query=Hverir'}, { time: '10:00-12:30', type: 'activity', description: 'ç±³æ¹–æº«æ³‰â™¨ï¸ + ç°¡å–®åˆé¤' }, { time: '12:30-13:20', type: 'drive', description: 'è»Šç¨‹' }, { time: '13:20-15:40', type: 'activity', description: 'çœ¾ç¥ç€‘å¸ƒ (GoÃ°afoss)', link: 'https://www.google.com/maps/search/?api=1&query=GoÃ°afoss' }, { time: '15:40-16:10', type: 'drive', description: 'è»Šç¨‹' }, { time: '16:10-16:30', type: 'food', description: 'äºåº«ä¾†æ­·å°è±¬è¶…å¸‚æ¡è²·', details: 'æ—é‚Šæœ‰TESLA è¶…å……', link: 'https://www.google.com/maps/search/?api=1&query=BÃ³nus, AustursÃ­Ã°a 2, Akureyri, Iceland' }, { time: 'ä¸‹åˆ', type: 'drive', description: 'é–‹è»Šå‰å¾€ä½å®¿é»', details: 'é˜¿å¬¤å®¶å‰é¢8å…¬é‡Œè™• ON POWERå……é›»' }, { time: 'æ™šä¸Š', type: 'stay', description: 'å…¥ä½ NeÃ°ra-Vatnshorn', details: 'ä½æ–¼HÃºnaÃ¾ingï¼Œç‚ºéš”æ—¥å‰å¾€æ–¯å¥ˆå±±åŠå³¶çš„ä¸­ç¹¼ç«™ã€‚<br>ç¸½åƒ¹: 215.46æ­å…ƒ<br>bookingå¯«æœ‰æ´—è¡£æ©Ÿ', link: 'https://www.google.com/maps/search/?api=1&query=NeÃ°ra-Vatnshorn+in+HÃºnaÃ¾ing' }] },
                { type: 'day_header', date: '2025/10/03 (äº”)', dayLabel: 'å†°å³¶ Day 6', title: 'ç«å±±æ¢éšªèˆ‡æ–¯å¥ˆå±±', events: [{ time: '08:00-11:30', type: 'drive', description: 'å¾åŒ—éƒ¨ä½å®¿é»å‡ºç™¼', details: 'é©…è»Šå‰å¾€VÃ­Ã°gelmirç†”å²©æ´ç©´ã€‚'},{ time: '11:30-13:00', type: 'activity', description: 'HellaferÃ° Ã­ VÃ­Ã°gelmi ç«å±±å…§éƒ¨æ¢éšª', details: 'å·²é è¨‚ (CAV-T102736015)<br>åƒåŠ é ç´„çš„ç†”å²©æ´ç©´å°è¦½ã€‚', link: 'https://thecave.is/' , linkText: 'æ´»å‹•å®˜ç¶²'},{ time: '13:00-14:00', type: 'food', description: 'åˆé¤', details: 'åŠ æ²¹ç«™åƒä¸€åƒ SkjÃ¡lftié™„è¿‘æœ‰ON POWER å……é›»æ¤¿'},{ time: '14:00-16:30', type: 'drive', description: 'å‰å¾€æ–¯å¥ˆå±±åŠå³¶å—å²¸'},{ time: '16:30-17:30', type: 'activity', description: 'æµ·è±¹æ²™ç˜ (Ytri Tunga)', link: 'https://www.google.com/maps/search/?api=1&query=Ytri+Tunga+beach' }, { time: '17:30-18:00', type: 'drive', description: 'é–‹è»Šè‡³é»‘æ•™å ‚' }, { time: '18:00-18:30', type: 'activity', description: 'é»‘æ•™å ‚ (BÃºÃ°akirkja)', link: 'https://www.google.com/maps/search/?api=1&query=BÃºÃ°akirkja' }, { time: '18:30-19:30', type: 'drive', description: 'é–‹è»Šè‡³åŒ—å²¸ä½å®¿é»' }, { time: 'å‚æ™š', type: 'stay', description: 'å…¥ä½ ViÃ° HafiÃ° Guesthouse', details: 'ä½æ–¼Olafsvikï¼Œé è¿‘æ•™æœƒå±±ã€‚<br>ISOKAå……é›»æ¨<br>ç¸½åƒ¹: 266.49æ­å…ƒ<br>æœ‰æ´—è¡£æ©Ÿ', link: 'https://www.google.com/maps/search/?api=1&query=ViÃ°+HafiÃ°+Guesthouse' }]},
                { type: 'day_header', date: '2025/10/04 (å…­)', dayLabel: 'å†°å³¶ Day 7', title: 'æ–¯å¥ˆå±±åŒ—å²¸ â†’ é¦–éƒ½ â†’ å¤©ç©ºæ½Ÿæ¹–', events: [{ time: '08:00-08:15', type: 'drive', description: 'å‡ºç™¼å‰å¾€å°ç´…å±‹' }, { time: '08:15-08:45', type: 'activity', description: 'IngjaldshÃ³ll Church (å°ç´…å±‹)', link: 'https://www.google.com/maps/search/?api=1&query=IngjaldshÃ³ll+Church' }, { time: '08:45-09:15', type: 'drive', description: 'å‰å¾€æ•™æœƒå±±' }, { time: '09:15-10:00', type: 'activity', description: 'æ•™æœƒå±± (Kirkjell)', link: 'https://www.google.com/maps/search/?api=1&query=Kirkjufell' }, { time: '10:00-12:30', type: 'drive', description: 'é–‹è»Šå‰å¾€å¤©ç©ºæ½Ÿæ¹–' }, { time: '12:30-15:00', type: 'activity', description: 'å¤©ç©ºæ½Ÿæ¹– (Sky Lagoon) æº«æ³‰é«”é©—å…¼åƒåˆé¤', link: 'https://www.google.com/maps/search/?api=1&query=Sky+Lagoon+Iceland' }, { time: '15:00-15:10', type: 'drive', description: 'å‰å¾€é™„è¿‘å°è±¬è¶…å¸‚' }, { time: '15:10-17:00', type: 'food', description: 'å°è±¬è¶…å¸‚æœ€å¾Œæ¡è²·', details: 'åœ°å€: NÃ½bÃ½lavegur, 200 KÃ³pavogur, å†°å³¶', link: 'https://www.google.com/maps/search/?api=1&query=BÃ³nus, NÃ½bÃ½lavegur, KÃ³pavogur' }, { time: '17:00-17:15', type: 'drive', description: 'å‰å¾€ Guesthouse Galtafell' }, { time: '17:15-17:35', type: 'stay', description: 'å…¥ä½ Guesthouse Galtafell æ”¾è¡Œæ', details: 'ç¸½åƒ¹: 260.30æ­å…ƒ<br>æœ‰æ´—è¡£æ©Ÿ', link: 'https://www.google.com/maps/search/?api=1&query=Guesthouse+Galtafell' }, { time: '17:35-18:00', type: 'drive', description: 'å‰å¾€ Blue Car Rental é‚„è»Š' }, { time: 'æ™šä¸Š', type: 'food', description: 'é›·å…‹é›…ç¶­å…‹å¸‚å€æ™šé¤' }] },
                { type: 'day_header', date: '2025/10/05 (æ—¥)', dayLabel: 'å†°å³¶ Day 8', title: 'é¦–éƒ½è§€å…‰ & æ­¸é€”', events: [{time: 'ä¸Šåˆ', type: 'activity', description: 'é›·å…‹é›…ç¶­å…‹å¸‚å€è§€å…‰', details: 'åƒè§€å“ˆçˆ¾æ ¼æ—å§†æ•™å ‚ã€åœ¨å¸‚å€æ¼«æ­¥ (ç„¡è»Šï¼Œæ¡æ­¥è¡Œæˆ–å¤§çœ¾é‹è¼¸)ã€‚'}, {time: 'ä¸­åˆ', type: 'food', description: 'BÃ¦jarins Beztu Pylsur ç†±ç‹—æ”¤'}, { time: '16:30', type: 'drive', description: 'æ­è»Šå‰å¾€KEFæ©Ÿå ´', details: 'FLY BUS ä¸‰é»åŠå››é»åŠæœ‰è»Š', link: 'https://www.re.is/tour/flybus/', linkText: 'BUSå®˜ç¶²' }, { time: '19:45', type: 'flight', description: 'å¾å†°å³¶ (KEF) å‡ºç™¼', details: 'æ­ä¹˜å†°å³¶èˆªç©ºè¿”å›è¥¿é›…åœ–ã€‚' }] },
            ],
            importantNotes: [
                { type: 'text', content: 'ç°½è­‰èˆ‡è­·ç…§ï¼šè«‹å‹™å¿…ç¢ºèªæ‚¨çš„è­·ç…§æ•ˆæœŸï¼ˆé€šå¸¸å»ºè­°è¡Œç¨‹çµæŸå¾Œä»æœ‰6å€‹æœˆä»¥ä¸Šæ•ˆæœŸï¼‰ï¼Œä¸¦æå‰è¾¦ç†æ‰€éœ€ç°½è­‰ï¼ˆç¾åœ‹ESTAåŠç”³æ ¹ç°½è­‰ï¼‰ã€‚'},
                { type: "voltage_plug", text: "é›»å£“èˆ‡æ’åº§ï¼šå†°å³¶çš„æ¨™æº–é›»å£“ç‚º 230Vï¼Œé »ç‡ç‚º 50Hzã€‚æ’åº§é¡å‹ç‚º F å‹ï¼ˆé›™åœ“å­”ï¼‰ï¼Œéœ€è¦æº–å‚™è½‰æ¥é ­ã€‚", imageUrl: "https://raw.githubusercontent.com/kellywukelly/0926-1007/main/Steckdose.jpg", imageAlt: "F å‹ (Schuko) æ’åº§èˆ‡æ’é ­ç¤ºæ„åœ–"},
                { type: 'text', content: 'è½‰æ©Ÿï¼šåœ‹éš›è½‰æ©Ÿè«‹é ç•™å……è¶³æ™‚é–“ï¼Œç‰¹åˆ¥æ˜¯ä¸åŒèˆªç©ºå…¬å¸ã€‚'},
                { type: 'text', content: 'ä½å®¿èˆ‡ç•¶åœ°äº¤é€šï¼šåˆ¥å¿˜äº†é è¨‚åœ¨è¥¿é›…åœ–ï¼ˆè‹¥éå¤œï¼‰åŠå†°å³¶çš„ä½å®¿èˆ‡ç•¶åœ°äº¤é€šã€‚'},
                { type: 'text', content: 'æ—…éŠä¿éšªï¼šå¼·çƒˆå»ºè­°è³¼è²·æ—…éŠå¹³å®‰éšªåŠæ—…éŠä¸ä¾¿éšªã€‚'}
            ],
            bookings: [
                { title: 'å†°ä¸Šæ‘©æ‰˜è»Š (Snowmobile tour on VatnajÃ¶kull Glacier)', ticket: 'FST-T102733345', provider: 'Glacierjourney / Fallastakkur', date: '2025/09/30 (äºŒ)', startTime: '09:30 AM', arrivalTime: '09:00 AM (éœ€æå‰30åˆ†é˜)', participants: '4ä½æˆäºº', meetingPoint: 'SmyrlabjÃ¶rg Hofn 781 IS (Hotel SmyrlabjÃ¶rg æ—çš„åŸºåœ°ç‡Ÿ)', contact: '+354 478 1517', cancellationPolicy: 'å¦‚æœåœ¨æ´»å‹•é–‹å§‹å‰ 2 å¤©ï¼ˆå«ï¼‰å…§å–æ¶ˆï¼Œå°‡æ”¶å– 90% çš„å–æ¶ˆè²»ç”¨ã€‚' },
                { title: 'ç«å±±å…§éƒ¨æ¢éšª (Cave Explorer)', ticket: 'CAV-T102736015', provider: 'The Cave', date: '2025/10/03 (äº”)', startTime: '11:30 AM', arrivalTime: '11:30 AM', participants: '4ä½æˆäºº', meetingPoint: 'The Cave VÃ­dgelmir, near HÃºsafell, Post Code: Reykholt 320 IS', contact: '+354 7833600', cancellationPolicy: 'å¦‚æœåœ¨æ´»å‹•é–‹å§‹å‰ 1 å¤©ï¼ˆå«ï¼‰å…§å–æ¶ˆï¼Œå°‡æ”¶å– 100% çš„å–æ¶ˆè²»ç”¨ã€‚' }
            ]
        };
        const icons = { flight: 'âœˆï¸', flight_arrival: 'ğŸ›¬', drive: 'ğŸš—', activity: 'ğŸï¸', food: 'ğŸ½ï¸', stay: 'ğŸ ', prep: 'ğŸ“‹', plan: 'âœï¸' };
        
        const preGeneratedPackingList = `
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">è­‰ä»¶èˆ‡æ–‡ä»¶</h4>
            <ul class="list-disc pl-5 space-y-1 mb-4">
                <li>è­·ç…§ï¼ˆæœ‰æ•ˆæœŸ6å€‹æœˆä»¥ä¸Šï¼‰ã€åœ‹éš›é§•ç…§ã€å°ç£é§•ç…§æ­£æœ¬</li>
                <li>æ©Ÿç¥¨ã€ä½å®¿ã€ç§Ÿè»Šç­‰é è¨‚ç¢ºèªä¿¡</li>
                <li>æ—…éŠä¿éšªè³‡æ–™</li>
                <li>ä¿¡ç”¨å¡ï¼ˆæœ‰PINç¢¼ï¼‰ã€å°‘é‡ç¾é‡‘ï¼ˆæ­å…ƒ/å†°å³¶å…‹æœ—ï¼‰</li>
                <li>ç·Šæ€¥è¯çµ¡è³‡è¨Š</li>
            </ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">è¡£ç‰©</h4>
            <ul class="list-disc pl-5 space-y-1 mb-4">
                <li>ç™¼ç†±è¡£ã€ä¿æš–å…§è¡£ã€æ¯›è¡£/æŠ“çµ¨è¡£</li>
                <li>ç¾½çµ¨å¤–å¥—æˆ–åšå¤–å¥—ã€é˜²æ°´é˜²é¢¨å¤–å¥—ã€é˜²æ°´é•·è¤²/ç™»å±±è¤²</li>
                <li>ä¿æš–è¤²/å…§æ­ä¸Šè¡£ã€Tæ¤/å…§æ­ä¸Šè¡£</li>
                <li>ä¿æš–è¥ªï¼ˆç¾Šæ¯›è¥ªï¼‰ã€å…§è¡£è¤²ã€ç¡è¡£</li>
                <li>æ¯›å¸½ã€åœå·¾ã€æ‰‹å¥—ã€å¤ªé™½çœ¼é¡ã€æ³³è¡£ã€æ‹–é‹/æ¶¼é‹</li>
            </ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">é‹é¡</h4>
            <ul class="list-disc pl-5 space-y-1 mb-4">
                <li>é˜²æ°´ç™»å±±é‹/å¥è¡Œé‹</li>
                <li>è¼•ä¾¿é‹</li>
            </ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">æ´—æ¼±èˆ‡å€‹äººç”¨å“</h4>
            <ul class="list-disc pl-5 space-y-1 mb-4">
                <li>ç‰™åˆ·ã€ç‰™è†ã€æ¢³å­ã€æ´—é¢ä¹³ã€æ´—é«®ç²¾ã€æ²æµ´ä¹³ã€æ¯›å·¾</li>
                <li>ä¿æ¿•ä¹³æ¶²ã€è­·å”‡è†ã€é˜²æ›¬ä¹³ã€æŒ‡ç”²å‰ª</li>
                <li>éš±å½¢çœ¼é¡åŠè—¥æ°´/çœ¼é¡</li>
                <li>å€‹äººè—¥å“ã€å°åŒ…è¡›ç”Ÿç´™ã€æ¿•ç´™å·¾ã€æœ¨ç“œéœœ/å‡¡å£«æ—</li>
            </ul>
             <h4 class="text-lg font-semibold text-emerald-700 mb-3">é›»å­ç”¢å“</h4>
            <ul class="list-disc pl-5 space-y-1 mb-4">
                <li>æ‰‹æ©Ÿèˆ‡å……é›»å™¨ã€ç›¸æ©Ÿ/é¡é ­/è¨˜æ†¶å¡/å‚™ç”¨é›»æ± </li>
                <li>è¡Œå‹•é›»æºã€æ­è¦è½‰æ¥é ­ã€è»Šç”¨å……é›»å™¨</li>
                <li>è€³æ©Ÿã€æ‰‹é›»ç­’/é ­ç‡ˆã€ç­†é›»/å¹³æ¿ï¼ˆå¦‚éœ€ï¼‰</li>
            </ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">æ—…è¡Œèˆ‡è‡ªé§•è£å‚™</h4>
            <ul class="list-disc pl-5 space-y-1 mb-4">
                <li>è¼•ä¾¿èƒŒåŒ…ã€è¡Œæç®±/å¤§èƒŒåŒ…ã€æ°´å£ºï¼ˆä¿æº«ç“¶ï¼‰</li>
                <li>å°å‹æ€¥æ•‘åŒ…ã€é›¨è¡£/é›¨è¤²ã€é˜²æ°´è¢‹/æ”¶ç´è¢‹</li>
                <li>çœ¼ç½©ã€è€³å¡ã€é£Ÿç‰©/é›¶é£Ÿã€æ—…è¡Œç”¨é¤å…·</li>
                <li>è»Šç”¨å……é›»å™¨ã€ä¿å†·è¢‹ã€å¤¾éŠè¢‹</li>
            </ul>
            <h4 class="text-lg font-semibold text-emerald-700 mb-3">å…¶ä»–å»ºè­°</h4>
            <ul class="list-disc pl-5 space-y-1">
                <li>æ¥µå…‰æ”å½±ç”¨ä¸‰è…³æ¶</li>
                <li>ç­†è¨˜æœ¬ã€ç­†ã€è¼•ä¾¿è³¼ç‰©è¢‹ã€æ›¸/é›»å­æ›¸</li>
            </ul>`;
            
        let todos = [];
        const TODO_STORAGE_KEY = 'icelandTripToDoList';

        document.addEventListener('DOMContentLoaded', () => {
            const timelineContainer = document.getElementById('timeline-container');
            const outboundFlightsContainer = document.getElementById('outbound-flights-container');
            const returnFlightsContainer = document.getElementById('return-flights-container');
            const notesContainer = document.getElementById('important-notes-container');
            const souvenirsContainer = document.getElementById('souvenirs-container');
            const bookingsContainer = document.getElementById('bookings-container');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const generalModal = document.getElementById('general-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalResponse = document.getElementById('modal-response');
            const modalLoading = document.getElementById('modal-loading');
            const modalError = document.getElementById('modal-error');

            function showModal(title, contentHTML = '', isStaticContent = false) {
                modalTitle.textContent = title;
                modalResponse.innerHTML = contentHTML;
                modalError.classList.add('hidden');
                modalError.textContent = '';
                modalLoading.classList.add('hidden');
                if (!isStaticContent) {
                    modalLoading.classList.remove('hidden');
                }
                generalModal.classList.remove('hidden');
                setTimeout(() => generalModal.classList.remove('opacity-0'), 10);
                setTimeout(() => document.querySelector('.modal-content').classList.remove('scale-95'), 10);
            }

            function hideModal() {
                generalModal.classList.add('opacity-0');
                document.querySelector('.modal-content').classList.add('scale-95');
                setTimeout(() => generalModal.classList.add('hidden'), 250);
            }

            modalCloseBtn.addEventListener('click', hideModal);
            generalModal.addEventListener('click', (event) => { if (event.target === generalModal) hideModal(); });

            function renderTimeline() {
                timelineContainer.innerHTML = '';
                tripData.timeline.forEach((day, index) => {
                    const dayWrapper = document.createElement('div');
                    dayWrapper.className = 'timeline-item mb-8';
                    let eventsHTML = day.events.map(event => `
                        <div class="flex items-start space-x-4 py-3 border-b border-slate-100 last:border-b-0">
                            <div class="flex-shrink-0 w-20 text-right font-semibold text-sky-600">${event.time || ''}</div>
                            <div class="flex-shrink-0 text-xl">${icons[event.type] || 'â¡ï¸'}</div>
                            <div class="flex-grow">
                                <p class="font-semibold text-slate-800">${event.description}</p>
                                ${event.details ? `<p class="text-sm text-slate-500 mt-1">${event.details}</p>` : ''}
                                ${event.link ? `<a href="${event.link}" target="_blank" rel="noopener noreferrer" class="inline-block mt-2 text-xs bg-sky-100 text-sky-700 font-semibold px-3 py-1 rounded-full hover:bg-sky-200 transition">${event.linkText || 'ğŸ“ åœ¨åœ°åœ–ä¸ŠæŸ¥çœ‹'}</a>` : ''}
                            </div>
                        </div>`).join('');
                    dayWrapper.innerHTML = `
                        <div class="timeline-content w-full md:w-11/12 lg:w-10/12 bg-white p-4 sm:p-6 rounded-lg shadow-lg border border-slate-200">
                            <div class="flex justify-between items-baseline mb-4">
                                <span class="text-xs font-bold uppercase text-white bg-sky-600 px-2 py-1 rounded-md">${day.dayLabel}</span>
                                <h2 class="text-xl sm:text-2xl font-bold text-slate-800">${day.title}</h2>
                                <time class="text-sm font-semibold text-slate-500">${day.date}</time>
                            </div>
                            <div class="space-y-1">${eventsHTML}</div>
                        </div>`;
                    timelineContainer.appendChild(dayWrapper);
                });
            }

            function renderFlights() {
                const createFlightCard = (flight) => `<div class="bg-white p-5 sm:p-6 rounded-lg shadow-lg border border-slate-200"><h3 class="text-xl font-semibold text-sky-700 mb-3">${flight.segmentName}</h3><div class="grid grid-cols-1 sm:grid-cols-3 gap-x-6 gap-y-4 text-sm text-slate-600"><div><p class="font-medium text-slate-800">âœˆï¸ èˆªç©ºå…¬å¸/èˆªç­ï¼š</p><p>${flight.airline}</p></div><div><p class="font-medium text-slate-800">ğŸ’° é‡‘é¡ (é ä¼°)ï¼š</p><p class="text-orange-600 font-semibold">${flight.cost}</p></div><div><p class="font-medium text-slate-800">ğŸ“ èˆªå»ˆï¼š</p><p>${flight.terminal || 'N/A'}</p></div><div class="sm:col-span-3 border-t border-slate-200 pt-4 mt-2"><div class="flex items-center justify-between space-x-4"><div class="text-center flex-1"><p class="text-xs text-slate-500">å‡ºç™¼</p><p class="font-semibold text-lg">${flight.origin.flag} ${flight.origin.code}</p><p class="text-xs">${flight.origin.name}</p><p class="text-xs mt-1">${flight.departureDateTime}</p></div><div class="text-slate-400 text-2xl">â†’</div><div class="text-center flex-1"><p class="text-xs text-slate-500">æŠµé”</p><p class="font-semibold text-lg">${flight.destination.flag} ${flight.destination.code}</p><p class="text-xs">${flight.destination.name}</p><p class="text-xs mt-1">${flight.arrivalDateTime}</p></div></div></div><div class="sm:col-span-3 mt-2"><p class="font-medium text-slate-800">ğŸ“ å‚™è¨»ï¼š</p><p class="prose prose-sm max-w-none">${flight.remarks.replace(/<br>/g, '<br>')}</p></div></div></div>`;
                outboundFlightsContainer.innerHTML = tripData.flights.filter(f => f.leg === 'outbound').map(createFlightCard).join('');
                returnFlightsContainer.innerHTML = tripData.flights.filter(f => f.leg === 'return').map(createFlightCard).join('');
            }

            function renderPrepTab() {
                const notesUl = document.createElement('ul');
                notesUl.className = "list-disc pl-5 space-y-4";
                tripData.importantNotes.forEach(note => {
                    const li = document.createElement('li');
                    if (note.type === 'voltage_plug') {
                        li.innerHTML = `${note.text} <br><img src="${note.imageUrl}" alt="${note.imageAlt}" class="mt-2 rounded-md shadow-sm max-w-[200px]" onerror="this.onerror=null;this.src='https://placehold.co/200x150/E2E8F0/475569?text=æ’åº§åœ–ç‰‡'">`;
                    } else {
                        li.textContent = note.content;
                    }
                    notesUl.appendChild(li);
                });
                notesContainer.innerHTML = '';
                notesContainer.appendChild(notesUl);

                souvenirsContainer.innerHTML = `
                    <ul class="list-disc pl-5 space-y-3">
                        <li><strong>å†°å³¶ç¾Šæ¯›è¡£ (Lopapeysa)</strong>ï¼šæœ€å…·ä»£è¡¨æ€§çš„ç´€å¿µå“ï¼Œä¿æš–ä¸”æœ‰ç¨ç‰¹åœ–é¨°ã€‚</li>
                        <li><strong>æˆ¶å¤–å“ç‰Œæœé£¾</strong>ï¼šå¦‚ 66Â°Northã€Zo-On ç­‰å†°å³¶æœ¬åœ°å“ç‰Œï¼Œå…¼å…·è¨­è¨ˆèˆ‡åŠŸèƒ½æ€§ã€‚</li>
                        <li><strong>Mills é­šå­é†¬</strong>ï¼šç‰™è†ç‹€çš„é­šå­é†¬ï¼Œåœ¨è¶…å¸‚å°±èƒ½è²·åˆ°ï¼Œæ˜¯ä¾¿å®œåˆç‰¹åˆ¥çš„ä¼´æ‰‹ç¦®ã€‚</li>
                        <li><strong>ç«å±±é£Ÿç”¨é¹½ (Lava Salt)</strong>ï¼šé»‘è‰²çš„é¹½ï¼Œå……æ»¿è¦–è¦ºæ•ˆæœèˆ‡å†°å³¶ç‰¹è‰²ã€‚</li>
                        <li><strong>æ³¡æ¾¡ï¼†æ³¡è…³é¹½</strong>ï¼šå«æœ‰å†°å³¶åœ°ç†±ç¤¦ç‰©è³ªçš„æµ´é¹½ï¼Œé©åˆé€ç¦®è‡ªç”¨ã€‚</li>
                        <li><strong>è‰æœ¬èŒ¶ (Herbal Tea)</strong>ï¼šå†°å³¶ç•¶åœ°å“ç‰Œçš„ç‰¹è‰²è‰æœ¬èŒ¶ï¼ŒåŒ…è£ç²¾ç¾ã€‚</li>
                        <li><strong>LYSIé­šæ²¹</strong>ï¼šå†°å³¶åœ‹æ°‘ä¿å¥å“ï¼Œå“è³ªå„ªè‰¯ã€‚</li>
                        <li><strong>EinstÃ¶k å•¤é…’</strong>ï¼šå†°å³¶æœ¬åœ°çš„ç²¾é‡€å•¤é…’ï¼Œæœ‰å¤šç¨®å£å‘³ã€‚</li>
                        <li><strong>å·§å…‹åŠ› (Omnom)</strong>ï¼šåŒ…è£è¨­è¨ˆç²¾ç¾çš„å†°å³¶çŸ¥åå·§å…‹åŠ›å“ç‰Œã€‚</li>
                        <li><strong>Puffin ç›¸é—œå•†å“</strong>ï¼šä»¥å¯æ„›çš„åœ‹é³¥å¸•èŠ¬é³¥ç‚ºä¸»é¡Œçš„å„ç¨®ç©å¶ã€é£¾å“ã€ç´€å¿µå“ã€‚</li>
                        <li><strong>ç«å±±ç†”å²©é£¾å“</strong>ï¼šä½¿ç”¨ç•¶åœ°ç«å±±å²©è£½ä½œçš„é …éŠã€æ‰‹ç’°ç­‰ã€‚</li>
                        <li><strong>ç£éµæ˜ä¿¡ç‰‡</strong>ï¼šæœ€åŸºæœ¬ä¹Ÿæœ€å—æ­¡è¿çš„ç´€å¿µå“ã€‚</li>
                    </ul>
                    <p class="mt-4 text-sm text-stone-500"><strong>åƒè€ƒè³‡æ–™ï¼š</strong> <a href="https://shiningchan.com/blog/post/iceland-souvenirs-recommendation/" target="_blank" class="text-sky-600 hover:underline">Shining Chan's Blog</a></p>`;
                
                const createBookingCard = (booking) => `<div class="p-4 border rounded-lg"><h4 class="font-bold text-md text-cyan-800">${booking.title}</h4><div class="mt-2 text-sm space-y-1 text-slate-600"><p><strong>é è¨‚è™Ÿç¢¼:</strong> ${booking.ticket}</p><p><strong>æ—¥æœŸ:</strong> ${booking.date}</p><p><strong>æ´»å‹•é–‹å§‹æ™‚é–“:</strong> ${booking.startTime}</p><p><strong>å»ºè­°æŠµé”æ™‚é–“:</strong> ${booking.arrivalTime}</p><p><strong>é›†åˆåœ°é»:</strong> ${booking.meetingPoint}</p><p><strong>è¯çµ¡é›»è©±:</strong> ${booking.contact}</p>${booking.cancellationPolicy ? `<p class="mt-2 pt-2 border-t border-slate-200"><strong>å–æ¶ˆæ”¿ç­–:</strong> ${booking.cancellationPolicy}</p>` : ''}</div></div>`;
                bookingsContainer.innerHTML = tripData.bookings.map(createBookingCard).join('');
            }
            
            // To-Do List Logic
            let todos = [];
            const TODO_STORAGE_KEY = 'icelandTripToDoList';

            function loadToDos() {
                const storedToDos = localStorage.getItem(TODO_STORAGE_KEY);
                const defaultToDos = [
                    { id: 5, text: "é è¨‚9/29 ä¸‹åˆ4é» éŠå‚‘å¤æ²™é¾å†°æ²³æ¹–æ´»å‹•", completed: false },
                    { id: 8, text: "é è¨‚10/4å¤©ç©ºæ½Ÿæ¹– (Sky Lagoon)", completed: false },
                    { id: 12, text: "é è¨‚10/5FLYBUSæ©Ÿå ´æ¥é§", completed: false },
                    { id: 9, text: "ç”³è«‹ç¾åœ‹ESTA", completed: false },
                    { id: 10, text: "æ›å°‘é‡å†°å³¶å…‹æœ— (ISK) ç¾é‡‘", completed: false },
                    { id: 11, text: "æº–å‚™ç¶²è·¯SIMå¡æˆ–Wi-Fiåˆ†äº«å™¨", completed: false }
                ];

                if (storedToDos && JSON.parse(storedToDos).length > 0) {
                    todos = JSON.parse(storedToDos);
                } else {
                    todos = defaultToDos; 
                    saveToDos();
                }
            }

            function saveToDos() { localStorage.setItem(TODO_STORAGE_KEY, JSON.stringify(todos)); }

            function renderToDoList() {
                const c = document.createElement('div');
                c.innerHTML = `<div class="flex mb-4"><input type="text" id="todo-input" placeholder="æ–°å¢å¾…è¾¦äº‹é …..." class="flex-grow p-2 border border-slate-300 rounded-l-md focus:ring-amber-500 focus:border-amber-500"><button id="add-todo-btn" class="bg-amber-500 hover:bg-amber-600 text-white p-2 rounded-r-md">æ–°å¢</button></div><ul id="todo-items-list" class="space-y-2"></ul>`;
                const ul = c.querySelector('#todo-items-list');
                todos.forEach(todo => {
                    const li = document.createElement('li');
                    li.className = `todo-item flex items-center justify-between p-2 border-b border-slate-200 ${todo.completed ? 'completed' : ''}`;
                    li.dataset.id = todo.id;
                    li.innerHTML = `<input type="checkbox" ${todo.completed ? 'checked' : ''} class="form-checkbox h-5 w-5 text-amber-500 rounded focus:ring-amber-400 mr-3 cursor-pointer"><span class="flex-grow cursor-pointer">${todo.text}</span><button class="text-red-400 hover:text-red-600 font-semibold ml-3">âœ•</button>`;
                    ul.appendChild(li);
                });
                c.querySelector('#add-todo-btn').addEventListener('click', () => {
                    const input = c.querySelector('#todo-input');
                    if (input.value.trim()) { addToDoItem(input.value.trim()); input.value = ''; }
                });
                c.querySelector('#todo-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') c.querySelector('#add-todo-btn').click(); });
                ul.addEventListener('click', (e) => {
                    const li = e.target.closest('li.todo-item'); if (!li) return; const id = Number(li.dataset.id);
                    if (e.target.type === 'checkbox' || e.target.tagName === 'SPAN') toggleComplete(id);
                    else if (e.target.tagName === 'BUTTON') deleteToDoItem(id);
                });
                return c.innerHTML;
            }
            
            function addToDoItem(text) { todos.push({ id: Date.now(), text, completed: false }); saveToDos(); modalResponse.innerHTML = renderToDoList(); }
            function toggleComplete(id) { const t = todos.find(x => x.id === id); if (t) t.completed = !t.completed; saveToDos(); modalResponse.innerHTML = renderToDoList(); }
            function deleteToDoItem(id) { todos = todos.filter(t => t.id !== id); saveToDos(); modalResponse.innerHTML = renderToDoList(); }
            
            // --- EVENT LISTENERS (FIXED) ---
            document.getElementById('btn-activity-ideas').addEventListener('click', async () => { 
                showModal('ğŸ’¡ æ´»å‹•éˆæ„Ÿ (AI æ”¯æ´)');
                const prompt = "æˆ‘å°‡åœ¨9æœˆåº•åˆ°10æœˆåˆå‰å¾€å†°å³¶æ—…éŠã€‚è«‹æ¨è–¦ä¸€äº›é©åˆé€™å€‹å­£ç¯€åœ¨å†°å³¶é€²è¡Œçš„æ´»å‹•å’Œå€¼å¾—æ¢è¨ªçš„æ™¯é»ã€‚è«‹ä»¥æ¢åˆ—å¼æ¸…å–®æ–¹å¼å‘ˆç¾ï¼Œä¸¦ç°¡çŸ­æè¿°æ¯å€‹é …ç›®ã€‚";
                try {
                    const ideasText = "This is a placeholder for the Gemini API response. Replace with actual API call if needed."; // Placeholder
                    modalResponse.innerHTML = ideasText.split('\n').map(line => `<p>${line.replace(/^[\-\*]\s*/, '')}</p>`).join('');
                } catch (error) {
                    modalError.textContent = `ç„¡æ³•å–å¾—æ´»å‹•å»ºè­°ï¼š${error.message}`;
                    modalError.classList.remove('hidden');
                } finally {
                    modalLoading.classList.add('hidden');
                }
            });
            document.getElementById('btn-packing-list').addEventListener('click', () => { showModal('ğŸ’ æ‰“åŒ…å»ºè­°', preGeneratedPackingList, true); });
            document.getElementById('btn-todo-list').addEventListener('click', () => { loadToDos(); showModal('ğŸ“‹ è¡Œå‰å¾…è¾¦æ¸…å–®', renderToDoList(), true); });
            
            // --- INITIALIZATION ---
            renderTimeline();
            renderFlights();
            renderPrepTab();
            
            const tabs = document.querySelectorAll('[data-tab]');
            const tabPanels = document.querySelectorAll('.tab-panel');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.replace('main-tab-active', 'main-tab-inactive'));
                    tab.classList.replace('main-tab-inactive', 'main-tab-active');
                    tabPanels.forEach(p => p.id === `${tab.dataset.tab}-content` ? p.classList.remove('hidden') : p.classList.add('hidden'));
                });
            });
            document.querySelector('[data-tab="timeline"]').click();
            const yearSpan = document.getElementById('currentYear');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }
        });
    </script>
</body>
</html>

